---
description: "Guidelines pour le projet Boost Odoo - Plateforme multi-tenant Odoo 18"
globs:
alwaysApply: true
---

# ğŸš€ Boost Odoo - Projet Multi-tenant

## ğŸ“‹ Vue d'ensemble

Plateforme **Odoo 18 Community** en mode **multi-tenant** permettant de gÃ©rer plusieurs clients avec des domaines dÃ©diÃ©s et des bases de donnÃ©es isolÃ©es.

## ğŸ—ï¸ Architecture

- **Odoo 18.0** : ERP open-source
- **PostgreSQL 15** : Base de donnÃ©es
- **Caddy 2.8** : Reverse proxy avec SSL automatique (Let's Encrypt)
- **Docker Compose** : Orchestration des conteneurs

## ğŸ”‘ Multi-tenant

### Convention de nommage

Le nom de base est formÃ© en **concatÃ©nant le sous-domaine + premiÃ¨re partie du domaine** (sans points) :

- `erp.casaobrasibiza.com` â†’ base : `erpcasaobrasibiza`
- `odoo.ibizaboost.com` â†’ base : `odooibizaboost`
- `boostcrm.com` â†’ base : `boostcrm`

### Fonctionnement

- **Module OCA** : `dbfilter_from_header` charge la base selon le header HTTP
- **Caddy** : Envoie le header `X-Odoo-dbfilter` avec le nom de la base
- **Isolation** : Chaque client a sa propre base de donnÃ©es et ses propres donnÃ©es

## ğŸ“ Structure du projet

```
Boost Odoo/
â”œâ”€â”€ addons/                    # Modules Odoo custom et OCA
â”‚   â”œâ”€â”€ dbfilter_from_header/  # Module multi-tenant (OCA)
â”‚   â””â”€â”€ helpdesk_mgmt/         # Module helpdesk (OCA)
â”œâ”€â”€ caddy/
â”‚   â””â”€â”€ sites/                 # Configurations client (*.caddy)
â”œâ”€â”€ data/                      # Filestore Odoo (ignorÃ© par git)
â”œâ”€â”€ postgres/                  # DonnÃ©es PostgreSQL (ignorÃ© par git)
â”œâ”€â”€ docs/                      # ğŸ“š DOCUMENTATION COMPLÃˆTE
â”‚   â”œâ”€â”€ WORKFLOW_CLIENT.md     # Guide gestion clients
â”‚   â””â”€â”€ PRODUCTION_WORKFLOW.md # Guide production
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ add-client.sh          # Script ajout client automatique
â”œâ”€â”€ docker-compose.yml         # Config dÃ©veloppement
â”œâ”€â”€ docker-compose.prod.yml    # Config production
â”œâ”€â”€ odoo.conf                  # Config dÃ©veloppement local
â”œâ”€â”€ odoo.prod.conf             # Config production (VPS)
â””â”€â”€ Caddyfile                  # Config reverse proxy
```

## ğŸ“š Documentation

**Toute la documentation est dans le dossier `docs/` :**

- **`docs/WORKFLOW_CLIENT.md`** : Guide complet pour ajouter/gÃ©rer des clients
- **`docs/PRODUCTION_WORKFLOW.md`** : Guide de dÃ©ploiement et gestion production
- **`README.md`** : Guide de dÃ©marrage rapide

## ğŸ”§ Environnements

### DÃ©veloppement Local

- Configuration : `odoo.conf`
- `list_db = True` (Database Manager activÃ©)
- `workers = 0` (hot reload)
- Pas de multi-tenant (pas de reverse proxy)
- Port : `http://localhost:8069`

### Production (VPS)

- Configuration : `odoo.prod.conf` (chargÃ© automatiquement)
- `list_db = False` (sÃ©curitÃ©)
- `workers = 4` (performances)
- Multi-tenant activÃ© (`dbfilter_from_header`)
- SSL automatique via Caddy
- Domaines : `https://erp.ibizaboost.com`, `https://odoo.ibizaboost.com`, etc.

## ğŸš€ Workflow ajout client

1. **GÃ©nÃ©rer la config Caddy** : `./scripts/add-client.sh casaobrasibiza.com erp`
2. **Configurer le DNS** : Pointer le domaine vers le VPS
3. **DÃ©ployer** : `git push` puis `git pull` sur le VPS
4. **CrÃ©er la base** : Via le Database Manager avec le nom exact
5. **RedÃ©marrer Caddy** : `docker-compose restart caddy`

Voir `docs/WORKFLOW_CLIENT.md` pour le guide dÃ©taillÃ©.

## ğŸ” SÃ©curitÃ© Production

- SSL automatique via Let's Encrypt
- Database Manager dÃ©sactivÃ© (`list_db = False`)
- PostgreSQL non exposÃ©
- Proxy mode activÃ© pour headers Caddy
- Master password Ã  changer (`admin_passwd` dans `odoo.prod.conf`)

## ğŸ¯ Modules disponibles

- **Base Odoo 18** : Tous les modules Community
- **dbfilter_from_header** : Multi-tenant (OCA)
- **helpdesk_mgmt** : Gestion des tickets support (OCA)
- Modules custom dans `addons/`

## ğŸ’¡ Conventions de code

- **Configs** : SÃ©parer dev/prod (odoo.conf / odoo.prod.conf)
- **Modules** : Placer dans `addons/`, commiter dans git
- **Caddy** : 1 fichier par client dans `caddy/sites/`
- **Nommage bases** : Pas d'espaces, points ou tirets (alphanumerique uniquement)
- **Documentation** : Tout dans `docs/` en Markdown

## ğŸ”„ DÃ©ploiement

```bash
# Local â†’ Git
git add . && git commit -m "message" && git push origin main

# VPS â†’ Pull et restart
ssh root@vps-ip
cd /opt/boost-odoo
git pull origin main
docker-compose -f docker-compose.yml -f docker-compose.prod.yml restart odoo
```

## ğŸ“ Support

Pour toute question, consulter :
- `docs/WORKFLOW_CLIENT.md` - Gestion clients
- `docs/PRODUCTION_WORKFLOW.md` - Production
- `README.md` - DÃ©marrage rapide
