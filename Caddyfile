{
    # Configuration globale
    email {$LETSENCRYPT_EMAIL}
    # Désactiver la télémétrie
    admin off
}

# ========================================
# DOMAINE PRINCIPAL (Database Manager)
# ========================================
{$DOMAIN} {
    # Compression (en dehors des handle, c'est OK)
    encode gzip
    
    # Websocket et Longpolling - Port 8072
    handle /websocket* {
        reverse_proxy odoo:8072
    }
    
    handle /longpolling/* {
        reverse_proxy odoo:8072
    }
    
    # Route principale - Port 8069
    handle {
        # Cache pour les assets statiques
        @static {
            path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
        }
        header @static Cache-Control "public, max-age=31536000"
        
        reverse_proxy odoo:8069
    }
    
    log {
        output file /var/log/caddy/main.log
    }
}

# ========================================
# CLIENTS - Import des configurations
# ========================================
# Ajoutez vos clients dans /caddy/sites/*.caddy
# Exemple: /caddy/sites/casaobras.caddy
import /caddy/sites/*.caddy

