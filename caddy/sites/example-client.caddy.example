# Exemple de configuration client
# Copiez ce fichier et renommez-le en : clientname.caddy

# Convention : Le nom de base = 2ème partie du domaine
# erp.casaobrasibiza.com → casaobrasibiza
# erp.iya.com → iya
# Regex dbfilter : ^[^.]+\.([^.]+)\..+$
erp.casaobras.com {
    # Compression
    encode gzip
    
    # Websocket et Longpolling - Port 8072
    handle /websocket* {
        reverse_proxy odoo:8072
    }
    
    handle /longpolling/* {
        reverse_proxy odoo:8072
    }
    
    # Route principale - Port 8069
    # Odoo gère le matching de base via dbfilter natif
    handle {
        # Cache pour les assets statiques
        @static {
            path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
        }
        header @static Cache-Control "public, max-age=31536000"
        
        reverse_proxy odoo:8069
    }
    
    log {
        output file /var/log/caddy/casaobras.log
    }
}

# Autre exemple : crm.iya.com → base de données "iya"
# crm.iya.com {
#     @no_db {
#         not query db=*
#     }
#     rewrite @no_db {uri}?db=iya
#     
#     reverse_proxy odoo:8069
#     
#     log {
#         output file /var/log/caddy/iya.log
#     }
# }

# Autre exemple : admin.autreclient.com → base de données "autreclient"
# admin.autreclient.com {
#     @no_db {
#         not query db=*
#     }
#     rewrite @no_db {uri}?db=autreclient
#     
#     reverse_proxy odoo:8069
#     
#     log {
#         output file /var/log/caddy/autreclient.log
#     }
# }

